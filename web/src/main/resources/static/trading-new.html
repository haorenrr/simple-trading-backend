<!DOCTYPE html>
<html lang="zh" xmlns="http://www.w3.org/1999/html" xmlns:background="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <script src="/js/vue.global.js"></script>
    <script src="/js/axios.min.js"></script>
    <script src="/js/echarts.min.js"></script>
    <script src = "/js/bootstrap.bundle.min.js"></script>

    <!--icons使用本地包不行，使用CDN可以，会额外请求字体文件，回头研究一下！
        答案：idea内置的built-in server（静态文件预览器）不提供 xx.woff格式的文件请求，因此会失败。启动正常的webserver等则无此问题，
        为了使用idea内置浏览器调试，先引用cdn模式
    -->
    <link rel="stylesheet" href="/font/bs-icons/bootstrap-icons.css">
    <!--        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">-->
    <link rel="stylesheet" href="/font/inter/inter.css">

    <style>
        /**
        如果在nav中使用 .fixed-top属性，这个nav将脱离文档流，后果就是会覆盖后续元素，解决办法就是：
        1） 把后续元素（<body>)整体后移，如这段css的定义
        2） 或者是，把fixed-top，替换为sticky-top
         */
        body{
            /*padding-top: 4.5rem;*/
        }
        /* 1. 锁定 navbar 本体高度 */
        .navbar-48 {
            height: 48px;
            padding-top: 0;
            padding-bottom: 0;
        }

        /* 2. container 垂直拉满 */
        .navbar-48 > .container-fluid {
            height: 100%;
        }

        /* 3. brand 精确对齐 */
        .navbar-48 .navbar-brand {
            font-size: 1rem;
            line-height: 1;
            padding: 0;
        }

        /* 4. nav-link 不再撑高 */
        .navbar-48 .nav-link {
            padding-top: 0;
            padding-bottom: 0;
            line-height: 48px;
        }

        /* 5. 最关键：压缩 toggler */
        .navbar-48 .navbar-toggler {
            padding: 0 0.5rem;
            height: 48px;
            line-height: 48px;
            border: none;
        }

        /* table header won't be bold*/
        .table-head-lgihter thead th{
            font-weight: lighter;
        }

        /* trading borad, setting its height mainly!  */
        .custom-main-board{
            height: 45vh;
            overflow: hidden;
        }

        /*优化UI样式*/
        /*添加新字体，Inter*/
        :root { font-family: 'Inter', sans-serif; }
        @supports (font-variation-settings: normal) {
            :root { font-family: 'Inter var', sans-serif; }
        }
        body {
            background-color: #f8fafc; /* 使用更高级的蓝灰色调背景 */
            font-family: 'Inter', -apple-system, sans-serif; /* 建议引入 Inter 字体 */
        }
        .card {
            border: none !important; /* 去掉生硬的边框 */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03); /* 柔和的阴影 */
            border-radius: 12px; /* 更圆润的角 */
        }
        /* 买入按钮：改为更深邃的翡翠绿 */
         .btn-success {
            background-color: #10b981 !important;
            border: none;
            padding: 10px 20px;
            font-weight: 600;
            transition: all 0.3s;
        }

        /* 卖出按钮：改为偏粉红的珊瑚色 */
         .btn-danger {
            background-color: #ef4444 !important;
            border: none;
        }

         .btn:hover {
            transform: translateY(-1px); /* 增加轻微的浮动感 */
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

         .table {
            --bs-table-bg: transparent;
            margin-bottom: 0;
        }

         .table th {
            text-transform: uppercase; /* 小标题全大写更显专业 */
            font-size: 0.75rem;
            letter-spacing: 0.05em;
            color: #94a3b8; /* 灰蓝色 */
            background-color: #fbfcfd;
            border-bottom: 1px solid #f1f5f9;
            font-weight: 700;
        }

         .table td {
            vertical-align: middle;
            font-size: 0.875rem;
            font-variant-numeric: tabular-nums; /* 确保价格位数对齐，不会晃动 */
            font-weight: 500;
        }
        /* 去掉表格生硬的边框，只保留水平分割线 */
        .table td, .table th {
            border-bottom: 1px solid #f1f5f9 !important; /* 使用浅灰色线 */
            border-top: none !important;
            padding: 12px 16px !important;
        }
        /* 移除交易记录背景的生硬颜色，改用极淡的背景 */
         .table-success, .table-success td {
             --flash-color: rgba(16, 185, 129, 0.4); /* 深绿， 这是个变量，子类中引用 */
             background-color: rgba(16, 185, 129, 0.06);
             /*color: #059669; 字体颜色*/
         }
         .table-danger, .table-danger td {
             --flash-color: rgba(244, 63, 94, 0.4); /* 深红，这是个变量，子类中引用 */
             background-color: rgba(244, 63, 94, 0.06) ;
             /*color: #e11d48;  字体颜色*/
         }

        /* 彻底去掉表格的斑马纹干扰，只用颜色区分 */
        .table-hover tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.02) ; /* 极其轻微的悬浮感 */
        }

        #liveStatus {
            background: rgba(16, 185, 129, 0.1) !important;
            color: #10b981 !important;
            border: 1px solid rgba(16, 185, 129, 0.2);
            backdrop-filter: blur(4px); /* 背景模糊 */
            padding: 4px 10px;
            border-radius: 20px;
        }

        /* 定义动画：从高亮色淡出到透明 */
        @keyframes row-flash {
            0% { background-color: var(--flash-color); } /* 初始：较明显的蓝色 */
            /*100% { background-color: transparent; }   */        /* 结束：透明 */
        }
        /* 动画类 */
        .row-animate-flash {
            animation: row-flash 2s ease-out forwards !important; /* 持续2秒，平滑结束 */
        }
        /* 核心方案：当 tr 闪烁时，强制让它下面的所有 td 背景透明 */
        .row-animate-flash td {
            background-color: transparent !important;
            transition: background-color 0.5s;
        }

        /**
        定义table样式，主要是固定高度
         */
        /* 针对 table 的上级div包装容器 */
        .table-container {
            height: 40vh; /* 或者使用 vh，如 40vh */
            overflow-y: auto; /* 纵向超出时显示滚动条 */
            position: relative;
        }

        /* 保持表头固定（极其重要！） */
        .table-container thead {
            position: sticky;
            top: 0;
            z-index: 10;
            background-color: #fbfcfd; /* 必须设置背景色，否则滚动时内容会重叠 */
        }

        /* 自定义滚动条样式，让它更细更现代 */
        .table-container::-webkit-scrollbar {
            width: 6px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background-color: #e2e8f0;
            border-radius: 10px;
        }

    </style>

    <title>Test</title>

</head>
<body class="d-flex flex-column min-vh-100">

<!--导航栏 -->
<nav class="navbar navbar-expand-md  bg-light navbar-light sticky-top border-bottom navbar-48">
    <p class="navbar-brand d-flex align-items-center mb-0">
        <i class="bi bi-lightning"></i>Trading!<i class="bi bi-lightning"></i>
    </p>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#willCollapse">
        <span class="navbar-toggler-icon"></span>zhedie
    </button>
    <div class="collapse navbar-collapse" id="willCollapse">
        <ul class="navbar-nav mx-auto">
            <li class="nav-item">
                <a class="nav-link active" href="#">APPL</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="#">NVDA</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="dropdownNav"  data-bs-toggle="dropdown"  href="#" >
                    Others
                </a>
                <div class="dropdown-menu" >
                    <a class="dropdown-item" href="#">Python 1</a>
                    <a class="dropdown-item" href="#">Python 2</a>
                    <a class="dropdown-item" href="#">Python 3</a>
                </div>
            </li>
        </ul>
        <form class="">
            <div class="input-group me-2">
                <input class="form-control" id="nav-search" type="text" placeholder="Search...">
                <button class="btn btn-success" type="submit">Search</button>
            </div>
        </form>
        <span class="navbar-text ms-3 me-5">
            <i class="bi bi-person-circle fs-3"></i>
        </span>
    </div>
</nav>

<div id="app-frame" class="container-fluid mt-1">
    <div class="row custom-main-board">
        <div class="col-3 bg-light">
            <div>
                <table class="table table-borderless table-hover table-light table-head-lgihter">
                    <thead>
                    <tr>
                        <th>Type</th>
                        <th>Available</th>
                        <th>Frozen</th>
                    </tr>
                    </thead>
                    <tbody>
                        <tr is="vue:asset-table" :items="assetItems"></tr>
                    </tbody>
                </table>
            </div>
            <div>
                <table class="table table-borderless table-head-lgihter mt-2">
                    <thead class="table-light">
                    <tr>
                        <th>Order Form</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>
                            <form @submit.prevent="orderSubmit($event)">
                                <div class="form-floating">
                                    <input class="form-control" id="price" type="number" min="0"
                                           name="amount" placeholder="Price.." v-model="orderForm.price" required>
                                    <label for="price" class="form-label">Price:</label>
                                </div>
                                <div class="form-floating mt-2">
                                    <input class="form-control" id="amount" type="number"  min="0"
                                           name="amount" placeholder="Amount.." v-model="orderForm.amount" required>
                                    <label for="amount" class="form-label">Amount:</label>
                                </div>
                                <div class="mt-2 d-flex gap-5">
                                    <button type="submit" id="buy" class="btn btn-success flex-fill" @click="orderForm.action='BUY'">BUY</button>
                                    <button type="submit" id="sell" class="btn btn-danger flex-fill" @click="orderForm.action='SELL'">SELL</button>
                                </div>
                            </form>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="col-6 bg-light">
            <div class="card h-100">
                <div class="card-header bg-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">交易分时图 (APPL)</h5>
                    <span class="badge bg-success" id="liveStatus">实时更新中</span>
                </div>
                <div class="card-body d-flex align-items-stretch">
                    <div id="stockChart" style="width: 100%; height: 100%"></div>
                </div>
            </div>
        </div>

        <div class="col-3 bg-light table-container">
            <table class="table  table-hover table-light table-head-lgihter">
                <thead>
                <tr>
                    <th>Type</th>
                    <th>Price</th>
                    <th>Amount</th>
                </tr>
                </thead>
                <tbody>
                    <template v-for="(item, index) in quotationItems" :key="index">
                        <tr v-if="item.tradeType === 'SELL'" class="table-success">
                            <td>SELL</td>
                            <td>{{ item.price }}</td>
                            <td>{{ item.volume }}</td>
                        </tr>
                        <tr v-else class="table-danger">
                            <td>BUY</td>
                            <td>{{ item.price }}</td>
                            <td>{{ item.volume }}</td>
                        </tr>
                    </template>
                </tbody>
            </table>
        </div>
    </div>
    <div class="row mt-4">
        <div class="col-9">
            <div class="card">
                <div class="card-body px-0 py-0 table-container">
                    <p class="card-title text-center fw-bold">MY Orders</p>
                    <table class="table table-hover table table-head-lgihter">
                        <thead>
                        <tr class="">
                            <th>Order ID</th>
                            <th>Type</th>
                            <th>Price</th>
                            <th>Amount</th>
                            <th>Finished</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- TIPS:
                            Vue 的 :class 接受的类型是：string | string[] | { [className: string]: boolean }
                            ?: → 返回字符串, {} → 返回对象, [] → 返回数组
                        -->
                            <tr v-for="(item, index) in avtiveOrderItems" :key="item.orderId"
                                :class="[item.type ==='SELL' ? 'table-success' : 'table-danger',{'row-animate-flash':item.isNew}]">
                                    <td>{{ item.orderId }}</td>
                                    <td>{{ item.type }}</td>
                                    <td class="text-start">{{ item.price }}</td>
                                    <td class="text-start">{{ item.amount }}</td>
                                    <td>{{ item.finished }}</td>
                                    <td>{{ item.status }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-3">
            <div class="card table-container">
                <div class="card-body px-0 py-0">
                    <p class="card-title text-center fw-bold">Finished Orders</p>
                    <table class="table  table-light table-hover table-head-lgihter">
                        <thead>
                        <tr class="">
                            <th>Type</th>
                            <th>Price</th>
                            <th>Amount</th>
                            <th>Time</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="item in tradeDetails" :key="item.id"
                            :class="[item.type === 'SELL' ?'table-success':'table-danger']">
                            <td>{{ item.type }}</td>
                            <td>{{ item.price }}</td>
                            <td>{{ item.amount }}</td>
                            <td>{{ item.time }}</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Making footer come to the End of screen:
    1) Using div.flex-grow-1, eating all remaining space;
    or 2) using footer.mt-auto let it start as bottom as possible
-->
<!--<div class="flex-grow-1"></div>-->
<footer class="border-top text-center py-3 mt-auto text-muted">
    <p class="text-muted text-center mb-0">
        Copyright @zyl 2025;<br>
        Powered by: springcloud,vue.js,bootstrap
    </p>
</footer>

<script>
    const { createApp, ref, shallowRef, onMounted, onUnmounted } = Vue;
    const BASE_URL = 'http://localhost:8080/';
    const USER_ID_PW = '10:pw'
    const HTTP_CONFIG = {
        params:{},
        headers:{
            "Authorization":"Basic " + USER_ID_PW,
            'accept': 'application/json'
        },
        baseURL:BASE_URL
    }
    let IS_DEBUG = true; //wether print from console.log() or not
    if(!IS_DEBUG){
        console.log = function() {};
    }

    let timer= null
    let stopPolling = false // false
    let pollingInterval = 3000
    let dataInited = false  // run at least once! for data init case

    const appData = {
        data(){
            return {
                /*
                assetItems:[
                    {assetType:"APPL", available:'3.5', frozen:'1.5'},
                    {assetType:"USD", available:'10', frozen:'3'}
                ],*/
                assetItems:[],
                /*
                quotationItems: [
                    {tradeType:"SELL", price: '8', volume: '4'},
                    {tradeType:"SELL", price: '9', volume: '3'}
                ],*/
                quotationItems:[],
                /*
                avtiveOrderItems: [
                    {orderId:'3568', type: 'SELL', price:'3.456', amount:'4', finished:'0', status:'0'},
                    {orderId:'3568', type: 'BUY', price:'6.78', amount:'8', finished:'0', status:'0'}
                ],
                */
                avtiveOrderItems:[],
                tradeDetails: [
                    {type:"SELL", price:"4.53", amount:"4.5", time:"12:30:32"},
                    {type:"BUY", price:"5.53", amount:"5.5", time:"12:31:32"},
                ],
                orderForm:{}
            }},
        methods: {
            async startPollingData(){
                if(stopPolling && dataInited) return;
                dataInited = true;
                try {
                    await Promise.all([
                        this.fetchAssetItems(),
                        this.fetchQuatationItems(),
                        this.fetchOrderList(),
                        this.fetchFinishedDetails()
                    ]);
                    console.log("Fetch data(s) and await over.")
                }catch(err){
                    console.error("Fetch data(s) error!", err)
                }
                timer = setTimeout(this.startPollingData, pollingInterval);
            },
            async fetchAssetItems(){
                // get asset
                await axios.get('/api/asset/list', {
                    params:{},
                    headers:{
                        "Authorization":"Basic " + USER_ID_PW,
                        'accept': 'application/json'
                    },
                    baseURL:BASE_URL
                })
                    .then(response => {
                        console.log("fetched asset, raw data=", response.data);
                        let rawData = response.data.data || [];
                        if(!rawData.some(item => item.assetType === 'APPL')){
                            rawData.push({assetType:"APPL", available:'0', frozen:'0'})
                        }
                        if(!rawData.some(item => item.assetType === 'USD')){
                            rawData.push({ assetType:"USD", available:'0', frozen:'0'})
                        }
                        this.assetItems = rawData;
                        console.log("processed assetItems = ", this.assetItems);
                    })
                    .catch(error => {
                        console.error('Fetch asset items fail!', error);
                    })
            },
            async fetchQuatationItems(){
                console.log("Begin to fetch quatationItems..");
                await axios.get('/api/trade/quotation', HTTP_CONFIG)
                .then(response => {
                    console.log("fetched trade quotation", response.data);
                    const rawData = response.data.data || {};
                    const rSellList =rawData.SELL || []
                    const rBuyList =rawData.BUY || []

                    if(rSellList.length === 0) rSellList.push({ price: '-', volume: '-',tradeType:'SELL',})
                    let sellList = rSellList.sort((a,b) => b.price - a.price).slice(0,5);

                    if (rBuyList.length === 0) rBuyList.push({price: '-', volume: '-', tradeType:'BUY',})
                    let buyList = rBuyList.sort((a,b) => b.price - a.price).slice(0,5);

                    let list = sellList.concat(buyList);
                    //console.log('list=', list);
                    this.quotationItems = list;
                })
                .catch(error => {
                    console.error("fetch quatation items fail!", error);
                })
            },
            async fetchOrderList(){
                await axios.get('/api/order/list', HTTP_CONFIG)
                    .then(response => {
                        const rawData = response.data.data || [];
                        console.log("fetched order list over, data=", rawData.slice(-2));
                        let mappedOrderItems = rawData.map(item => {
                            let newRcd = true;
                            if(this.avtiveOrderItems.some(
                                i => i.orderId === item.id && i.updatedAt === item.updatedAt)) {
                                newRcd = false;
                                //console.log("fetched order items, Fetched some old items!");
                            }
                            return {
                                orderId: item.id,
                                price: item.price,
                                type: item.tradeType,
                                amount: item.amount,
                                finished: item.finishedAmount,
                                status: item.status,
                                updatedAt: item.updatedAt,
                                isNew:newRcd
                            };
                        });
                        let sortedMappedOrderItems = mappedOrderItems.sort((a,b) => {
                            let at = new Date(a.updatedAt)
                            let bt = new Date(b.updatedAt)
                            return bt.getTime() - at.getTime();
                        });
                        console.log("mapppedOrders=", sortedMappedOrderItems.slice(0,2));
                        this.avtiveOrderItems = sortedMappedOrderItems.slice(0,15);
                        setTimeout(() => {
                            this.avtiveOrderItems?.forEach((item) => item.isNew = false);
                        },1500)
                    })
                    .catch(error => {
                        console.error("fetch order lists fail!", error);
                    })
            },
            async orderSubmit(event){
                console.log("begin to submit order...", this.orderForm);
                // http://localhost:8080/api/trade/sell?price=10&amount=1'
                let url = (this.orderForm.action === 'SELL')?'/api/trade/sell':'/api/trade/buy';
                await axios.get(url, {
                    ...HTTP_CONFIG,
                    params: {
                        price:this.orderForm.price,
                        amount:this.orderForm.amount
                    }
                })
                .then(response => {
                    console.log("order submitted. order=", response.data.data);
                })
                .catch(error => {
                    console.error("order submitt fail!", error);
                })
                this.orderForm = {} //reset order form
            },
            async fetchFinishedDetails(){
                await axios.get('api/trade/finishedDetails', HTTP_CONFIG)
                .then(response => {
                    console.log("fetched finished details:", response.data.data);
                    const rawData = response.data.data || [];
                    let fmtedData = rawData.map(item => {
                        let localTime = new Date(item.updatedAt);
                        return {
                            id: item.id + localTime.getTime(),
                            type: item.tradeType,
                            price: item.price,
                            amount: item.amount,
                            time: localTime.toLocaleTimeString() // HH:mm:ss
                        }
                    })
                    let sortedFmtedData = fmtedData.sort((a,b) => b.time.localeCompare(a.time));
                    this.tradeDetails = sortedFmtedData;
                })
                .catch(error => {
                    console.error("fetch finished details fail!", error);
                })
            }
        },
        computed:{},
        components:{},
        created(){
            console.log("app created.");
        },
        mounted(){
            console.log("root mounted over.")
            this.startPollingData();
        },
        beforeUnmount() {
            stopPolling = true
        },
        setup(){
            const chartInst = shallowRef(null);
            const chartData = ref({})
            let tickTimer = null

            const initChart = () => {
                const chartDom = document.getElementById('stockChart');
                chartInst.value = echarts.init(chartDom);
                const now = Date.now();
                const start = now - 1 * 60 * 1000
                const future = now + 9 * 60 * 1000;//10分钟
                const options = {
                    grid: { // 调整图表的边距，否则图标会被挤在中间
                        top: '10%', bottom: '10%', left: '5%', right: '5%',
                        containLabel: true // 核心：设为 true，ECharts 会自动调整间距以确保坐标轴文字不被切掉
                    },
                    xAxis: {
                        type: 'time',
                        min: start,
                        max: future,
                        boundaryGap: false,
                        //data:[],
                        axisLabels: {
                            formatter: (value) => {
                                const date = new Date(value);
                                const hour = date.getHours();
                                const minute = date.getMinutes().toString().padStart(2, "0");
                                const second = date.getSeconds().toString().padStart(2, "0");
                                return `${hour}:${minute}:${second}`;
                            },
                            hideOverlap: true,
                        },
                        axisTick:{ show: false }, // 隐藏 X 轴刻度短线
                        axisLine: {lineStyle: { color: '#eee' } } // 让轴线颜色淡一点
                    },
                    yAxis: {
                        type: 'value',
                        scale: false,
                        axisTick: {show: false},
                        splitLine: {lineStyle: { type: 'dashed' }}, // 背景线设为虚线，更有高级感
                        axisLabel: {
                            margin: 8, // 文字距离轴线的距离
                            fontSize: 10,
                            color: '#999'
                        }
                    },
                    series: [{
                        type: 'line',
                        smooth: true,
                        symbol:'none',
                        data: [],
                        showSymbol: false, // 只有鼠标悬停才显示圆点

                        lineStyle: {
                            width: 2,
                            color: '#ef4444', // 2) 股市常用的红色 (Coral Red)
                            shadowColor: 'rgba(59, 130, 246, 0.3)',
                            shadowBlur: 10
                        },
                        areaStyle: {
                            // 给曲线下方加一点极淡的红色渐变，更有质感
                            color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                                { offset: 0, color: 'rgba(239, 68, 68, 0.2)' },
                                { offset: 1, color: 'rgba(239, 68, 68, 0)' }
                            ]),
                            lineStyle: {color: '#3a84ff', width: 2}
                        }
                    }]
                }
                chartInst.value.setOption(options);
            };

            const fetchRealTimeTicks = async () => {
                await axios.get('/api/trade/realtime-ticks', {
                    ...HTTP_CONFIG,
                    params: {num_items: 100}
                })
                .then(response => {
                    const rawData = response.data.data || [];
                    console.log("fetched ticks...");
                    if(rawData.length === 0)
                        return;
                    rawData.forEach(item => {
                        const {time, price} = item;
                        const curTimestamp = Math.floor(new Date(time).getTime()/1000) * 1000; //时间戳,精度到秒
                        chartData.value[curTimestamp] = price // 有，就直接覆盖，没有，就直接添加
                    })
                    let sortedTimes = Object.keys(chartData.value).sort();
                    let sortedTuple = sortedTimes.map((k) => {
                        return[
                            Number(k), // 关键：手动转回数字，确保 ECharts time轴识别准确, 否则传过去的是字符串型！
                            chartData.value[k]
                        ]
                    })
                    console.log("sortedTimes:", sortedTimes.slice(-5))
                    console.log("sortedTuple:", sortedTuple.slice(-5))
                    chartInst.value.setOption({
                        //xAxis: {data: sortedTimes},
                        series: [
                            {data: sortedTuple}
                        ]
                    })
                })
                .catch(error => {
                    console.error("fetch ticks fail!", error);
                })
            };

            onMounted(() => {
                initChart();
                fetchRealTimeTicks(); // 立即执行一次
                if(!stopPolling)
                    tickTimer = setInterval(fetchRealTimeTicks, pollingInterval); // 每3秒轮询一次

                // 响应式缩放
                window.addEventListener('resize', () => chartInst.value?.resize());
            });

            onUnmounted(() => {
                clearInterval(tickTimer); // 销毁组件时清除定时器
            });

            return {};//没有需要直接暴露给HTML模板的变量
        }
    }
    const app = Vue.createApp(appData)
    app.component('asset-table',{
        template: `
                <tr v-for="(item, index) in items" :key="index">
                  <td>{{ item.assetType }}</td>
                  <td>{{ item.available }}</td>
                  <td>{{ item.frozen }}</td>
                </tr>
        `,
        props: ['items'],
        data(){
            return {}
        },
        computed:{},
        methods:{},
        mounted(){}
    })
    app.mount('#app-frame')
</script>
</body>
</html>